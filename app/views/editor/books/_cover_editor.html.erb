<div data-controller="cover-editor" class="flex flex-col md:flex-row gap-6">
  <!-- Current Cover Display -->
  <div class="flex-1">
    <% if book.cover_image.attached? %>
      <div class="aspect-[3/4] bg-gray-100 rounded-lg overflow-hidden">
        <%= image_tag book.cover_image.variant(resize_to_limit: [800, 1067]),
                      alt: "Book cover",
                      class: "w-full h-full object-cover",
                      data: { cover_editor_target: "preview" } %>
      </div>
    <% else %>
      <div class="aspect-[3/4] bg-gray-100 rounded-lg flex flex-col items-center justify-center text-gray-400"
           data-cover-editor-target="preview">
        <%= icon "image", class: "w-16 h-16 mb-2" %>
        <p class="text-sm">No cover image yet</p>
      </div>
    <% end %>
  </div>

  <!-- Upload Controls -->
  <div class="flex-1 space-y-4">
    <div>
      <h3 class="text-sm font-medium text-gray-700 mb-2">Upload New Cover</h3>
      <p class="text-xs text-gray-500 mb-4">
        Upload an image for your book cover. Recommended size: 600x800 pixels (3:4 aspect ratio).
      </p>

      <%= form_with url: editor_child_profile_book_path(child_profile, book),
                    method: :patch,
                    multipart: true,
                    data: { cover_editor_target: "form" },
                    class: "space-y-4" do |f| %>

        <!-- File Input -->
        <div>
          <%= file_field_tag :cover_image,
                            accept: "image/*",
                            data: {
                              cover_editor_target: "fileInput",
                              action: "change->cover-editor#previewFile"
                            },
                            class: "block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" %>
        </div>

        <!-- Upload Button -->
        <div>
          <%= submit_tag "Upload Cover", class: "btn btn-primary w-full" %>
        </div>
      <% end %>
    </div>

    <!-- Remove Current Cover (if exists) -->
    <% if book.cover_image.attached? %>
      <div class="pt-4 border-t border-gray-200">
        <%= button_to "Remove Cover",
                      editor_child_profile_book_path(child_profile, book),
                      method: :patch,
                      params: { remove_cover: true },
                      data: { turbo_confirm: "Are you sure you want to remove the cover image?" },
                      class: "btn btn-secondary w-full text-red-600 hover:text-red-700" %>
      </div>
    <% end %>

    <!-- Future: AI Generated Cover -->
    <div class="pt-4 border-t border-gray-200">
      <button type="button"
              disabled
              class="btn btn-secondary w-full opacity-50 cursor-not-allowed flex items-center justify-center gap-2">
        <%= icon "sparkles", class: "w-4 h-4" %>
        <span>Generate AI Cover (Coming Soon)</span>
      </button>
    </div>
  </div>
</div>
