<div data-controller="page-editor"
     data-page-editor-update-url-value="<%= editor_child_profile_book_page_path(child_profile, book, drawing) %>"
     class="bg-gray-50 rounded-lg border border-gray-200 hover:border-gray-300 transition-colors">

  <!-- Page Number -->
  <div class="flex items-center justify-between p-3 bg-white border-b border-gray-200 rounded-t-lg">
    <div class="flex items-center gap-2">
      <span class="text-sm font-semibold text-gray-700">Page <%= index + 1 %></span>
      <% if drawing.is_cover %>
        <span class="px-2 py-0.5 bg-blue-100 text-blue-800 text-xs rounded">Cover</span>
      <% end %>
    </div>

    <!-- Delete Button -->
    <%= button_to editor_child_profile_book_page_path(child_profile, book, drawing),
                  method: :delete,
                  data: {
                    turbo_confirm: "Are you sure you want to delete this page? This action cannot be undone.",
                    page_editor_target: "deleteButton"
                  },
                  class: "text-red-600 hover:text-red-800 transition-colors" do %>
      <%= icon "trash-2", class: "w-4 h-4" %>
    <% end %>
  </div>

  <!-- Image Preview -->
  <div class="p-4">
    <% if drawing.image.attached? %>
      <div class="aspect-square bg-gray-100 rounded-lg overflow-hidden mb-4">
        <%= image_tag drawing.image.variant(:medium),
                      alt: "Page #{index + 1}",
                      class: "w-full h-full object-contain" %>
      </div>
    <% else %>
      <div class="aspect-square bg-gray-100 rounded-lg overflow-hidden mb-4 flex items-center justify-center">
        <%= icon "image", class: "w-12 h-12 text-gray-300" %>
      </div>
    <% end %>

    <!-- Text Editing Form -->
    <%= form_with model: drawing,
                  url: editor_child_profile_book_page_path(child_profile, book, drawing),
                  method: :patch,
                  data: { page_editor_target: "form" },
                  class: "space-y-3" do |f| %>

      <!-- Narration Text -->
      <div>
        <label class="block text-xs font-medium text-gray-700 mb-1">Narration</label>
        <%= f.text_area :narration_text,
                       data: {
                         page_editor_target: "narrationText",
                         action: "blur->page-editor#autoSave"
                       },
                       rows: 3,
                       class: "w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",
                       placeholder: "Once upon a time..." %>
      </div>

      <!-- Dialogue Text -->
      <div>
        <label class="block text-xs font-medium text-gray-700 mb-1">Dialogue</label>
        <%= f.text_area :dialogue_text,
                       data: {
                         page_editor_target: "dialogueText",
                         action: "blur->page-editor#autoSave"
                       },
                       rows: 2,
                       class: "w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",
                       placeholder: "\"Hello!\" said..." %>
      </div>

      <!-- Caption (existing field) -->
      <div>
        <label class="block text-xs font-medium text-gray-700 mb-1">Caption</label>
        <%= f.text_field :caption,
                        data: {
                          page_editor_target: "caption",
                          action: "blur->page-editor#autoSave"
                        },
                        class: "w-full px-3 py-2 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",
                        placeholder: "Optional caption..." %>
      </div>

      <!-- Action Buttons -->
      <div class="flex gap-2 pt-2">
        <%= f.submit "Save", class: "btn btn-sm btn-primary flex-1" %>
      </div>
    <% end %>
  </div>
</div>
