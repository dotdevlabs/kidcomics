<div class="min-h-screen bg-gray-50">
  <!-- Header -->
  <div class="bg-white shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
      <h1 class="text-3xl font-bold text-gray-800">Settings</h1>
      <p class="text-gray-600 mt-1">Configure email and system settings</p>
    </div>
  </div>

  <!-- Main Content -->
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <% if flash[:notice] %>
      <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-6">
        <%= flash[:notice] %>
      </div>
    <% end %>

    <% if flash[:alert] %>
      <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6">
        <%= flash[:alert] %>
      </div>
    <% end %>

    <!-- Email Settings Card -->
    <div class="bg-white rounded-lg shadow-md overflow-hidden mb-6">
      <div class="bg-gradient-to-r from-purple-600 to-blue-600 px-6 py-4">
        <div class="flex items-center">
          <%= icon "mail", class: "w-6 h-6 text-white mr-3" %>
          <h2 class="text-xl font-bold text-white">Email Configuration (Postmark)</h2>
        </div>
      </div>

      <div class="p-6">
        <!-- Status Indicator -->
        <div class="mb-6 p-4 rounded-lg <%= @postmark_configured ? 'bg-green-50 border border-green-200' : 'bg-yellow-50 border border-yellow-200' %>">
          <div class="flex items-center">
            <% if @postmark_configured %>
              <%= icon "circle-check", class: "w-5 h-5 text-green-600 mr-2" %>
              <span class="text-green-800 font-semibold">Email service configured</span>
            <% else %>
              <%= icon "alert-circle", class: "w-5 h-5 text-yellow-600 mr-2" %>
              <span class="text-yellow-800 font-semibold">Email service not configured</span>
            <% end %>
          </div>
        </div>

        <!-- Postmark API Key -->
        <div class="mb-6">
          <%= form_with url: admin_settings_path, method: :patch, class: "space-y-4" do |f| %>
            <%= hidden_field_tag :setting_key, "postmark_api_key" %>

            <div>
              <%= label_tag :setting_value, "Postmark API Key", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= password_field_tag :setting_value, @postmark_api_key,
                  placeholder: "Enter your Postmark Server API Token",
                  class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" %>
              <p class="text-xs text-gray-500 mt-1">
                Get your API key from <%= link_to "Postmark Dashboard", "https://account.postmarkapp.com/", target: "_blank", class: "text-purple-600 hover:text-purple-800" %>
              </p>
            </div>

            <%= submit_tag "Update API Key", class: "bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition" %>
          <% end %>
        </div>

        <hr class="my-6">

        <!-- From Email Address -->
        <div class="mb-6">
          <%= form_with url: admin_settings_path, method: :patch, class: "space-y-4" do |f| %>
            <%= hidden_field_tag :setting_key, "postmark_from_email" %>

            <div>
              <%= label_tag :setting_value, "From Email Address", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= email_field_tag :setting_value, @postmark_from_email,
                  placeholder: "noreply@yourdomain.com",
                  class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" %>
              <p class="text-xs text-gray-500 mt-1">
                This email address must be verified in your Postmark account
              </p>
            </div>

            <%= submit_tag "Update From Address", class: "bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition" %>
          <% end %>
        </div>

        <% if @postmark_configured %>
          <hr class="my-6">

          <!-- Test Email -->
          <div>
            <h3 class="text-lg font-semibold text-gray-800 mb-3">Test Email Configuration</h3>
            <p class="text-sm text-gray-600 mb-4">
              Send a test email to your account (<%= current_user.email %>) to verify everything is working correctly.
            </p>

            <%= form_with url: test_email_admin_settings_path, method: :post do |f| %>
              <%= submit_tag "Send Test Email", class: "bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition inline-flex items-center" %>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Help Card -->
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
      <div class="flex items-start">
        <%= icon "info", class: "w-5 h-5 text-blue-600 mr-3 flex-shrink-0 mt-0.5" %>
        <div>
          <h3 class="text-lg font-semibold text-blue-900 mb-2">Setting up Postmark</h3>
          <ol class="text-sm text-blue-800 space-y-2 list-decimal list-inside">
            <li>Sign up for a free Postmark account at <%= link_to "postmarkapp.com", "https://postmarkapp.com", target: "_blank", class: "text-blue-600 hover:underline" %></li>
            <li>Create a new "Server" in your Postmark account</li>
            <li>Copy the "Server API Token" from the API Tokens tab</li>
            <li>Paste it into the API Key field above</li>
            <li>Add and verify your sending domain in Postmark</li>
            <li>Update the From Email Address to use your verified domain</li>
            <li>Send a test email to confirm everything works</li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</div>
