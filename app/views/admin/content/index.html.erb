<% content_for :title, "Content Moderation" %>

<h1 class="text-3xl font-bold mb-6">Content Moderation</h1>

<!-- Filter Tabs -->
<div class="bg-white rounded-lg shadow mb-6">
  <div class="flex border-b">
    <%= link_to "All", admin_content_index_path, class: "px-6 py-3 #{params[:filter].blank? ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600 hover:text-gray-800'}" %>
    <%= link_to "Needs Review", admin_content_index_path(filter: 'needs_review'), class: "px-6 py-3 #{params[:filter] == 'needs_review' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600 hover:text-gray-800'}" %>
    <%= link_to "Pending", admin_content_index_path(filter: 'pending'), class: "px-6 py-3 #{params[:filter] == 'pending' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600 hover:text-gray-800'}" %>
    <%= link_to "Flagged", admin_content_index_path(filter: 'flagged'), class: "px-6 py-3 #{params[:filter] == 'flagged' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600 hover:text-gray-800'}" %>
    <%= link_to "Approved", admin_content_index_path(filter: 'approved'), class: "px-6 py-3 #{params[:filter] == 'approved' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600 hover:text-gray-800'}" %>
    <%= link_to "Rejected", admin_content_index_path(filter: 'rejected'), class: "px-6 py-3 #{params[:filter] == 'rejected' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600 hover:text-gray-800'}" %>
  </div>
</div>

<!-- Content Table -->
<div class="bg-white rounded-lg shadow overflow-hidden">
  <table class="min-w-full divide-y divide-gray-200">
    <thead class="bg-gray-50">
      <tr>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Book Title</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Child/Family</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Moderation</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Created</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
      </tr>
    </thead>
    <tbody class="bg-white divide-y divide-gray-200">
      <% @books.each do |book| %>
        <tr>
          <td class="px-6 py-4 whitespace-nowrap font-medium"><%= book.title %></td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
            <%= book.child_profile.name %><br>
            <span class="text-xs"><%= book.child_profile.family_account.owner.name %></span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">
              <%= book.status.titleize %>
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full <%=
              case book.moderation_status
              when 'pending_review' then 'bg-yellow-100 text-yellow-800'
              when 'approved' then 'bg-green-100 text-green-800'
              when 'flagged' then 'bg-red-100 text-red-800'
              when 'rejected' then 'bg-gray-100 text-gray-800'
              end
            %>">
              <%= book.moderation_status.humanize %>
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
            <%= time_ago_in_words(book.created_at) %> ago
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm">
            <%= link_to "Review", admin_content_path(book), class: "text-blue-600 hover:underline" %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<% if @books.empty? %>
  <div class="text-center py-12 text-gray-500">
    No content found.
  </div>
<% end %>
