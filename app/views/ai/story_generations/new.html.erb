<div class="max-w-4xl mx-auto p-6">
  <div class="mb-6">
    <h1 class="text-3xl font-bold text-gray-900">Generate AI Story</h1>
    <p class="mt-2 text-gray-600">Create an illustrated story from your drawings using AI</p>
  </div>

  <% if @book.drawings.empty? %>
    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
      <div class="flex items-start">
        <%= icon "circle-alert", class: "w-5 h-5 text-yellow-600 mt-0.5 mr-3" %>
        <div>
          <h3 class="text-sm font-medium text-yellow-800">No Drawings Yet</h3>
          <p class="mt-1 text-sm text-yellow-700">
            You need to upload at least one drawing before generating a story.
          </p>
          <%= link_to "Add Drawings", new_child_profile_book_drawing_path(@child_profile, @book),
              class: "mt-2 inline-block text-sm font-medium text-yellow-800 hover:text-yellow-900 underline" %>
        </div>
      </div>
    </div>
  <% end %>

  <div class="bg-white shadow rounded-lg">
    <div class="p-6">
      <h2 class="text-xl font-semibold mb-4">Your Drawings</h2>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
        <% @book.drawings.each do |drawing| %>
          <div class="relative aspect-square bg-gray-100 rounded-lg overflow-hidden">
            <%= image_tag drawing.image.variant(:medium),
                class: "w-full h-full object-cover",
                alt: drawing.caption || "Drawing" %>
            <% if drawing.tag.present? %>
              <span class="absolute top-2 right-2 px-2 py-1 text-xs font-medium bg-white/90 rounded">
                <%= drawing.tag %>
              </span>
            <% end %>
          </div>
        <% end %>
      </div>

      <%= form_with model: @story_generation,
          url: ai_child_profile_book_story_generations_path(@child_profile, @book),
          class: "space-y-6" do |form| %>

        <div>
          <%= form.label :story_prompt, "Tell us about your story", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= form.text_area :story_prompt,
              rows: 6,
              placeholder: "What should the story be about? What happens to the characters? Where does the story take place?",
              class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",
              required: true %>
          <p class="mt-2 text-sm text-gray-500">
            Describe the story you'd like to create. Our AI will use your drawings and this description to generate an illustrated storybook.
          </p>
        </div>

        <div class="flex items-center justify-between pt-4 border-t">
          <%= link_to "Cancel", child_profile_book_path(@child_profile, @book),
              class: "px-4 py-2 text-sm font-medium text-gray-700 hover:text-gray-900" %>
          <%= form.submit "Generate Story",
              class: "px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors",
              disabled: @book.drawings.empty? %>
        </div>
      <% end %>
    </div>
  </div>

  <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
    <div class="flex items-start">
      <%= icon "info", class: "w-5 h-5 text-blue-600 mt-0.5 mr-3" %>
      <div class="text-sm text-blue-800">
        <h3 class="font-medium mb-1">How it works</h3>
        <ul class="list-disc list-inside space-y-1 text-blue-700">
          <li>AI analyzes your drawings to identify characters and art style</li>
          <li>Generates a story based on your description</li>
          <li>Creates illustrated pages with dialogue and narration</li>
          <li>You can edit and regenerate any page after generation</li>
          <li>Generation typically takes 2-5 minutes</li>
        </ul>
      </div>
    </div>
  </div>
</div>
