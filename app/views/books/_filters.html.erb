<%
  # Defaults
  show_child_filter ||= false
  child_profiles ||= []
%>

<div class="bg-white rounded-lg shadow-md p-6 mb-6" data-controller="filter">
  <div class="flex items-center justify-between mb-4">
    <h2 class="text-xl font-bold text-gray-800 flex items-center">
      <%= icon "sliders-horizontal", class: "w-5 h-5 mr-2" %>
      Filters
    </h2>
    <%= link_to request.path, class: "text-sm text-gray-600 hover:text-gray-800 flex items-center" do %>
      <%= icon "x", class: "w-4 h-4 mr-1" %>
      Clear All
    <% end %>
  </div>

  <%= form_with url: request.path, method: :get, data: { turbo_frame: "books_list", filter_target: "form", action: "change->filter#submit" }, class: "space-y-4" do |f| %>
    <!-- Search -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2">
        <%= icon "search", class: "w-4 h-4 inline mr-1" %>
        Search by Title
      </label>
      <%= f.text_field :search, value: params[:search], placeholder: "Enter book title...", class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent", data: { action: "input->filter#debounceSubmit" } %>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
      <!-- Child Profile Filter (if enabled) -->
      <% if show_child_filter && child_profiles.any? %>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Child</label>
          <%= f.select :child_profile_id,
              options_for_select([["All Children", ""]] + child_profiles.map { |cp| [cp.name, cp.id] }, params[:child_profile_id]),
              {},
              class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" %>
        </div>
      <% end %>

      <!-- Status Filter -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
        <%= f.select :status,
            options_for_select([["All", "all"], ["Draft", "draft"], ["Published", "published"]], params[:status] || "all"),
            {},
            class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" %>
      </div>

      <!-- Favorites Filter -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">
          <%= icon "star", class: "w-4 h-4 inline mr-1" %>
          Favorites
        </label>
        <%= f.select :favorited,
            options_for_select([["All Books", ""], ["Favorites Only", "true"]], params[:favorited]),
            {},
            class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" %>
      </div>

      <!-- Sort -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Sort By</label>
        <%= f.select :sort,
            options_for_select([["Newest First", "newest"], ["Oldest First", "oldest"], ["Title A-Z", "title"], ["Most Popular", "popularity"]], params[:sort] || "newest"),
            {},
            class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" %>
      </div>
    </div>

    <!-- Date Range Filters -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">
          <%= icon "calendar", class: "w-4 h-4 inline mr-1" %>
          From Date
        </label>
        <%= f.date_field :date_from, value: params[:date_from], class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" %>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">
          <%= icon "calendar", class: "w-4 h-4 inline mr-1" %>
          To Date
        </label>
        <%= f.date_field :date_to, value: params[:date_to], class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" %>
      </div>
    </div>

    <!-- Hidden field to preserve view mode -->
    <%= f.hidden_field :view_mode, value: params[:view_mode] %>
  <% end %>
</div>
